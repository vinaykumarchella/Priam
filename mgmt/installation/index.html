



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
        <meta name="author" content="Netflix">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-3.0.5">
    
    
      
        <title>Installation - Priam</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.451f80e5.css">
      
      
    
    
      <script src="../../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#installation" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="Priam" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                Priam
              </span>
              <span class="md-header-nav__topic">
                Installation
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/Netflix/priam/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      Netflix/priam
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../.." title="Priam" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Priam
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/Netflix/priam/" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      Netflix/priam
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Getting started." class="md-nav__link">
      Getting started.
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#build-process" title="Build Process" class="md-nav__link">
    Build Process
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#auto-scaling-group-setup" title="Auto Scaling Group setup" class="md-nav__link">
    Auto Scaling Group setup
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#choosing-asg-name" title="Choosing ASG name" class="md-nav__link">
    Choosing ASG name
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#web-container-setup" title="Web Container setup" class="md-nav__link">
    Web Container setup
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#credentials" title="Credentials" class="md-nav__link">
    Credentials
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#iamcredential" title="IAMCredential" class="md-nav__link">
    IAMCredential
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#s3-buckets" title="S3 Buckets" class="md-nav__link">
    S3 Buckets
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#simpledb-domains" title="SimpleDB Domains" class="md-nav__link">
    SimpleDB Domains
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#priamstartupagent-and-nfseedprovider" title="PriamStartupAgent and NFSeedProvider" class="md-nav__link">
    PriamStartupAgent and NFSeedProvider
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configuration" title="Configuration" class="md-nav__link">
    Configuration
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#providing-start-and-stop-scripts" title="Providing start and stop scripts" class="md-nav__link">
    Providing start and stop scripts
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploying" title="Deploying" class="md-nav__link">
    Deploying
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#verification" title="Verification" class="md-nav__link">
    Verification
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/Netflix/priam/edit/master/docs/mgmt/installation.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="installation">Installation</h1>
<p>Priam provides several default implementations (AWS, Configuration, credentials etc). You can use these or choose to create your own.</p>
<ul>
<li>Build the code</li>
<li>Set up your auto-scale group (ASG) and spin up instances</li>
<li>Install Cassandra and web container (such as tomcat) on your instances.</li>
<li>Setup aws credentials and SimpleDB properties</li>
<li>Create S3 buckets to store your backups</li>
<li>Copy priam-cass-extensions-<version>.jar into your $CASS_HOME/lib directory</li>
<li>Add -javaagent:<code>$CASS_HOME/lib/priam-cass-extensions-&lt;version&gt;.jar</code> to cassandra's JVM arguments</li>
<li>Configure basic configurations</li>
<li>Deploy Priam.war in your container</li>
</ul>
<h2 id="build-process">Build Process</h2>
<p>Checkout the code from git and run:
<code>/gradlew build</code>
The gradlew script will pull down all necessary gradle components/infrastructure automatically, then run the build. </p>
<p>This should create both a jar and a war file for your project. Note that, the default provided log4j.properties assumes tomcat deployment. Modify this according to your needs.</p>
<p>Priam uses Google Guice. You can override several of the default implementations and bind your implementations in the provided Guice module (see PriamGuiceModule.java)</p>
<h2 id="auto-scaling-group-setup"><a href="http://aws.amazon.com/autoscaling/">Auto Scaling Group</a> setup</h2>
<p>When setting up ASG, using as-create-auto-scaling-group, set availability zone to single zone (--availability-zones). For high availability, set multiple ASGs with one zone per ASG.</p>
<h3 id="choosing-asg-name">Choosing ASG name</h3>
<p>Your Cassandra cluster could be spanning multiple ASGs. Such cases arise when you want to provide HA across zones and to overcome the AWS limitation of load balancing across zones i.e., currently, AWS does not guarantee instances will be balanced across zones if instances are not available in a particular zone. In such cases, you could create multiple ASGs with each ASG bound to single zone.</p>
<p>In such cases your ASG name should be suffixed with <code>'-{ZONE}'</code>. Eg: <code>test_cluster-useast1a.</code></p>
<h2 id="web-container-setup">Web Container setup</h2>
<p>Since Priam changes the configuration files for Cassandra and starts/stops the services, the web container it's running in must have execute rights on the script to modify the cassandra.yaml file and execute the <code>/etc/init.d/cassandra</code> (configurable location) script.</p>
<h2 id="credentials">Credentials</h2>
<p>The default implementation uses clear text credentials. To use this provide AWS accessid and secrectkey in <code>-/etc/awscredential.properties</code> -- copy and modify from <code>src/main/resources/conf/awscredential.properties</code>. </p>
<p>You can however, override ICredential to provide a more secure way of obtaining credentials. Additionally, ensure your keys do not contain special characters and are not enclosed in quotes of any kind. </p>
<p>The preferred way is to use IAM key profile management. </p>
<h3 id="iamcredential">IAMCredential</h3>
<p>Using IAM Credentials allows you to provide access to the AWS api without storing an AccessKeyId or SecretAccessKey anywhere on the machine.</p>
<ol>
<li>Create a new IAM Role in the AWS console or using the API and make sure it can access EC2, S3, and SimpleDB resources.</li>
<li>Assign that role to the auto scaling group.</li>
<li>Modify <code>priam/src/main/java/com/netflix/priam/defaultimpl/PriamGuiceModule.java</code></li>
</ol>
<p>```java
   // Add this line
   import com.netflix.priam.aws.IAMCredential;</p>
<p>public class PriamGuiceModule extends AbstractModule {
           bind(IBackupFileSystem.class).annotatedWith(Names.named("backup")).to(S3FileSystem.class);
           bind(IBackupFileSystem.class).annotatedWith(Names.named("incr_restore")).to(S3FileSystem.class);
           bind(IBackupFileSystem.class).annotatedWith(Names.named("backup_status")).to(S3FileSystem.class);
           .....
           // Add this line
           bind(ICredential.class).to(IAMCredential.class);
       }
 ```</p>
<h2 id="s3-buckets">S3 Buckets</h2>
<ul>
<li>Create an S3 bucket to store your backup files. The default bucket name used by PriamConfiguration is cassandra-archive.</li>
<li>Ensure the Credentials used above has permissions to read/write to this S3 bucket. For best performance (and cost), consider creating one S3 bucket per AWS region. </li>
</ul>
<h2 id="simpledb-domains">SimpleDB Domains</h2>
<p>Priam uses SimpleDB to register nodes as well as read properties.</p>
<p>Create the following SimpleDB domains: InstanceIdentity &amp; PriamProperties. </p>
<p>Use PriamProperties to add properties if you want to modify defaults. InstanceIdentity is used by Priam to register nodes. The SimpleDB domains must be located in the US-East-1 region.</p>
<p><strong>Note</strong>: SimpleDB Configuration Management and Token Management is soon to be deprecated and moved to use DynamoDB.</p>
<h2 id="priamstartupagent-and-nfseedprovider">PriamStartupAgent and NFSeedProvider</h2>
<p>These are the 2 classes that will be required by Cassandra for starting and fetching token, seeds and other information from Priam. You will need to copy priam-cass-extensions-<version>.jar into your $CASS_HOME/lib directory, and add -javaagent:$CASS_HOME/lib/priam-cass-extensions-<version>.jar to cassandra's JVM arguments.</p>
<p>Priam updates cassandra.yaml with NFSeedProvider by default.</p>
<h2 id="configuration">Configuration</h2>
<p>To change the default Priam properties, you can create property items in the PriamProperties SimpleDB domain. Each property item is defined by the attributes appId, property and value. appId is set to the ASG name by default. When using multiple ASGs, the zone suffix is removed. Refer above for ASG naming convention. Refer to Properties for property name and default value for all property items.</p>
<h3 id="providing-start-and-stop-scripts">Providing start and stop scripts</h3>
<ol>
<li>Configure the name of the application. </li>
<li>As part of the configuration provide any custom start and stop scripts to Priam via properties. PriamConfiguration defaults to <code>/etc/init.d/cassandra</code> script for starting and stopping.    </li>
</ol>
<h2 id="deploying">Deploying</h2>
<p>Copy the jar generated in the build step into the cassandra lib directory. Deploy the war into your web container.</p>
<h3 id="verification">Verification</h3>
<p>To see if Priam has started successfully, you can lookup SimpleDB InstanceIdentity domain for entries for the ASG. Each entry will have instanceid, hostname, token and other details used by the particular node.</p>
<p>You can also verify REST API by running:</p>
<p><code>$curl http://localhost:8080/Priam/REST/v1/cassconfig/get_token</code></p>
<p>This should return the token used by node. Kudos if you reached so far! Ensure your Cassandra process is up and is using the same token found by running the above command.</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright 2018 Netflix, Inc.
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.583bbe55.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
    
    
      
    
  </body>
</html>